I"Û5<p>æœ€è¿‘åœ¨çœ‹<a href="https://python.swaroopch.com/">ã€Šç®€æ˜ Python æ•™ç¨‹(A Byte of Python)ã€‹</a>ï¼Œä¹¦ä¸­æœ‰ä¸€ä¸ªå°ç»ƒä¹ ï¼Œéœ€æ±‚ä¸ºâ€œæˆ‘æƒ³è¦ä¸€æ¬¾ç¨‹åºæ¥å¤‡ä»½æˆ‘æ‰€æœ‰çš„é‡è¦æ–‡ä»¶â€ã€‚å…·ä½“è¦æ±‚å¦‚ä¸‹ï¼š<br />
ï¼ˆ1ï¼‰éœ€è¦å¤‡ä»½çš„æ–‡ä»¶ä¸ç›®å½•åº”åœ¨ä¸€ä»½åˆ—è¡¨ä¸­äºˆä»¥æŒ‡å®šï¼›<br />
ï¼ˆ2ï¼‰å¤‡ä»½å¿…é¡»å­˜å‚¨åœ¨ä¸€ä¸ªä¸»å¤‡ä»½ç›®å½•ä¸­ï¼›<br />
ï¼ˆ3ï¼‰å¤‡ä»½æ–‡ä»¶å°†æ‰“åŒ…å‹ç¼©æˆ zip æ–‡ä»¶ï¼›<br />
ï¼ˆ4ï¼‰zip å‹ç¼©æ–‡ä»¶çš„æ–‡ä»¶åç”±å½“å‰æ—¥æœŸä¸æ—¶é—´æ„æˆï¼›<br />
ï¼ˆ5ï¼‰æˆ‘ä»¬ä½¿ç”¨åœ¨ä»»ä½• GNU/Linux æˆ– Unix å‘è¡Œç‰ˆä¸­éƒ½ä¼šé»˜è®¤æä¾›çš„æ ‡å‡† zip å‘½ä»¤è¿›è¡Œæ‰“åŒ…ã€‚<br />
éœ€è¦å®ç°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„è¿è¡Œæ•ˆæœï¼š
<img src="/assets/image/20180313_effect_backup.png" alt="effect" /></p>

<p>è·Ÿç€ä¹¦ä¸­çš„æ€è·¯ï¼Œé€æ­¥ä¿®æ”¹å®Œå–„ï¼Œå¾—åˆ°äº†å¦‚ä¸‹å®Œæ•´å®ç°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>  
<span class="kn">import</span> <span class="nn">os</span>  
  
<span class="c1">#ç”¨ä¸€ä¸ªåˆ—è¡¨æ¥å­˜æ”¾æ‰€æœ‰éœ€è¦å¤‡ä»½çš„æ–‡ä»¶å’Œç›®å½•  
</span><span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s">'/path/to/file1'</span><span class="p">,</span> <span class="s">'/path/to/diretory1'</span><span class="p">,</span> <span class="s">'/path/to/file2'</span><span class="p">,</span>  
    <span class="s">'/path/to/file3'</span><span class="p">,</span> <span class="s">'/path/to/directory2'</span><span class="p">]</span>  
<span class="c1">#æŒ‡å®šç”¨äºå­˜æ”¾å¤‡ä»½æ–‡ä»¶çš„ç›®æ ‡ç›®å½•  
</span><span class="n">target_dir</span> <span class="o">=</span> <span class="s">'/path/to/backup/directory/'</span>  
  
  
<span class="c1">#å¦‚æœç›®æ ‡ç›®å½•ä¸å­˜åœ¨ï¼Œå°±å…ˆåˆ›å»ºè¯¥ç›®å½•  
</span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target_dir</span><span class="p">):</span>  
    <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span>  
<span class="n">today</span> <span class="o">=</span> <span class="n">target_dir</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">time</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%Y%m%d'</span><span class="p">)</span>  
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">today</span><span class="p">):</span>  
    <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">today</span><span class="p">)</span>  
    <span class="k">print</span><span class="p">(</span><span class="s">'Successfully created directory'</span><span class="p">,</span> <span class="n">today</span><span class="p">)</span>  
  
<span class="c1">#å¤‡ä»½æ–‡ä»¶çš„å‘½åæ–¹å¼ä¸ºâ€œæ—¥æœŸ+ç”¨æˆ·è¾“å…¥.zipâ€  
</span><span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%H%M%S'</span><span class="p">)</span>  
<span class="n">comment</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'Enter a comment --&gt;'</span><span class="p">)</span>  
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  
    <span class="n">target</span> <span class="o">=</span> <span class="n">today</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">now</span> <span class="o">+</span> <span class="s">'.zip'</span>  
<span class="k">else</span><span class="p">:</span>  
    <span class="n">target</span> <span class="o">=</span> <span class="n">today</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">now</span> <span class="o">+</span> <span class="s">'_'</span> <span class="o">+</span> \  
        <span class="n">comment</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">'_'</span><span class="p">)</span> <span class="o">+</span> <span class="s">'.zip'</span>  
  
<span class="c1">#é€šè¿‡os.systemæ–¹æ³•è°ƒç”¨ç³»ç»Ÿå‘½ä»¤zipæ¥å®ç°æ–‡ä»¶çš„å‹ç¼©å’Œå½’æ¡£  
</span><span class="n">zip_command</span> <span class="o">=</span> <span class="s">'zip -r {0} {1}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s">' '</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">sources</span><span class="p">))</span>  
<span class="k">print</span><span class="p">(</span><span class="s">'Zip commands is:'</span><span class="p">)</span>  
<span class="k">print</span><span class="p">(</span><span class="n">zip_command</span><span class="p">)</span>  
  
<span class="k">print</span><span class="p">(</span><span class="s">'Running:'</span><span class="p">)</span>  
<span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="n">zip_command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  
    <span class="k">print</span><span class="p">(</span><span class="s">'Successful backup to '</span> <span class="o">+</span> <span class="n">target</span><span class="p">)</span>  
<span class="k">else</span><span class="p">:</span>  
    <span class="k">print</span><span class="p">(</span><span class="s">'Backup FAILED'</span><span class="p">)</span>  
</code></pre></div></div>

<p>ä½œä¸ºè¯¾å¤–ç»ƒä¹ ï¼Œä¹¦ä¸­æåˆ°å¯ä»¥å°è¯•ä½¿ç”¨<a href="https://docs.python.org/3/library/zipfile.html">zipfileæ¨¡å—</a>æ¥æ›¿ä»£os.systemè°ƒç”¨ï¼Œå®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚é€šè¿‡æŸ¥<a href="https://docs.python.org/3/library/">Pythonæ–‡æ¡£</a>å’Œgoogleï¼Œå†™å‡ºäº†å¦‚ä¸‹å®ç°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>  
<span class="kn">import</span> <span class="nn">os</span>  
<span class="kn">import</span> <span class="nn">zipfile</span>  
  
<span class="c1">#ç”¨ä¸€ä¸ªåˆ—è¡¨æ¥å­˜æ”¾æ‰€æœ‰éœ€è¦å¤‡ä»½çš„æ–‡ä»¶å’Œç›®å½•  
</span><span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s">'/path/to/file1'</span><span class="p">,</span> <span class="s">'/path/to/diretory1'</span><span class="p">,</span> <span class="s">'/path/to/file2'</span><span class="p">,</span>  
    <span class="s">'/path/to/file3'</span><span class="p">,</span> <span class="s">'/path/to/directory2'</span><span class="p">]</span>  
<span class="c1">#æŒ‡å®šç”¨äºå­˜æ”¾å¤‡ä»½æ–‡ä»¶çš„ç›®æ ‡ç›®å½•  
</span><span class="n">target_dir</span> <span class="o">=</span> <span class="s">'/path/to/backup/directory/'</span>  
  
  
<span class="c1">#å¦‚æœç›®æ ‡ç›®å½•ä¸å­˜åœ¨ï¼Œå°±å…ˆåˆ›å»ºè¯¥ç›®å½•  
</span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target_dir</span><span class="p">):</span>  
    <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span>  
<span class="n">today</span> <span class="o">=</span> <span class="n">target_dir</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">time</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%Y%m%d'</span><span class="p">)</span>  
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">today</span><span class="p">):</span>  
    <span class="n">os</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">today</span><span class="p">)</span>  
    <span class="k">print</span><span class="p">(</span><span class="s">'Successfully created directory'</span><span class="p">,</span> <span class="n">today</span><span class="p">)</span>  
  
<span class="c1">#å¤‡ä»½æ–‡ä»¶çš„å‘½åæ–¹å¼ä¸ºâ€œæ—¥æœŸ+ç”¨æˆ·è¾“å…¥.zipâ€  
</span><span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%H%M%S'</span><span class="p">)</span>  
<span class="n">comment</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'Enter a comment --&gt;'</span><span class="p">)</span>  
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  
    <span class="n">target</span> <span class="o">=</span> <span class="n">today</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">now</span> <span class="o">+</span> <span class="s">'.zip'</span>  
<span class="k">else</span><span class="p">:</span>  
    <span class="n">target</span> <span class="o">=</span> <span class="n">today</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">now</span> <span class="o">+</span> <span class="s">'_'</span> <span class="o">+</span> \  
        <span class="n">comment</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">'_'</span><span class="p">)</span> <span class="o">+</span> <span class="s">'.zip'</span>  
  
<span class="c1">#å¯¹äºæ–‡ä»¶åˆ—è¡¨ä¸­çš„ç›®å½•ï¼Œé€’å½’åœ°æå–å…¶ä¸­åŒ…å«çš„æ–‡ä»¶  
</span><span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>  
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  
    <span class="n">path</span> <span class="o">=</span> <span class="n">sources</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  
    <span class="k">del</span> <span class="n">sources</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  
    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>  
        <span class="n">files</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>  
    <span class="k">else</span><span class="p">:</span>  
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>  
            <span class="n">sources</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">os</span><span class="p">.</span><span class="n">sep</span> <span class="o">+</span> <span class="n">item</span><span class="p">)</span>  
  
<span class="c1">#ç”¨zipfileæ¨¡å—å‹ç¼©å’Œå½’æ¡£æ–‡ä»¶åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ–‡ä»¶  
</span><span class="k">with</span> <span class="n">zipfile</span><span class="p">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s">'x'</span><span class="p">)</span> <span class="k">as</span> <span class="n">myzip</span><span class="p">:</span>  
    <span class="k">print</span><span class="p">(</span><span class="s">'Running:'</span><span class="p">)</span>  
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>  
        <span class="k">print</span><span class="p">(</span><span class="s">'adding:'</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>  
        <span class="n">myzip</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  
<span class="k">print</span><span class="p">(</span><span class="s">'Successful backup to '</span> <span class="o">+</span> <span class="n">target</span><span class="p">)</span>  
</code></pre></div></div>
:ET